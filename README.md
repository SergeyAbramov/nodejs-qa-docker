# docker

https://github.com/nlapshin/nodejs-qa-docker

1. Кто работал с докером(знает, слышал и т.д.)?
2. Кто запускал хоть какую-то виртуальную?
3. Зачем она нам нужна?
- экономия железа
- разнообразие сред
- переиспользование образов(одно окружения для разным хост-машин)
- изолированность: есть хост, а есть изолированная среда для запуска чего-либо.

Мы создаем виртуальную машину для каких целей.

- Операционная система(Ubuntu и т.д.)
- Сколько ресурсов мы ей выделим(места, память, видео-память): 20, 2 Гб, сколько-нибудь.
- выполняем бизнес-задачу.

Бизнес-задача - это запуск e2e тесты.

- нужна ли нам вся операционная система Ubuntu? Нам нужен минимальный образ для запуска тестов(nodejs + headless-browser).
- минимальное количество ресурсов для запуска браузера.
- выполнить бизнес-задачу в максимально автономном режиме.

Создали пайплайн - запустили наши тесты где-то(на сервере и т.д.) - посмотрели результ(все ли зеленое) - делаем деплой(или другой кейс)

# Образы

- ubuntu
- nodejs - все необходимое для того, чтобы nodejs работал

У каждого образа есть tag. Образ nodejs версии 18.

Мы можем их оттуда скачивать. И можем публиковать.

docker pull hello-world - это скачать образ с registry
docker run hello-world - создали(запустили) конейнер на базе образа hello-world

Как происходит поиск образа?

- образ ищется по название на вашем компьютере
- если не находит, то обращается к registy
  
Можете запустить скачивание с вашего персонального registry

Опишите последовательность действий которые нужно сделать с git-репозиторием, чтобы запустить тесты.

1. Сколнировать репозиторий.
2. npm i
3. npm test


Хост-машину и виртуалку(контейнер).

1. Сколнировать репозиторий.
2. Скопировать все файлы, которые необходимы для запуска тестов(package.json, package-lock.json, конфиги и исходники)
3. npm i
4. npm test

Dockerfile - это специальный файл для создания образов. Мы берем базовый образ(образ, где есть nodejs)
и прописываем последовательность действий для выполнения нашей бизнес-задачи(запуск тестов).


Когда все выполнится 22.

Создали образ.

docker build . --tag nlapshin/node-docker-qa - собирает образ и задаем ему имя nlapshin/node-docker-qa

Число 18

docker build ./path/to/directory Точка - это контекст(в разрезе файловой системы) запуска

docker ps - посмотреть список всех запущенных контейнеров.
docker rm <name> - это удалить контейнер
docker run -it - запустить в интерактивном режим
docker exec -it my-qa-container sh - подключить к терминалу контейнера

1. Есть билд-сервер, который собирает образы.
2. Мы имея систему CI/CD жмек кнопку собрать образ.
3. Образ собирается, вешает тэг и публикуется в registry.
4. Нажимаем кнопку, которая говорит другому серверу(скачай образ с таким тэгом и запусти его)
